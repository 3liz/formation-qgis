
<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>Étiquettes</title>
  <link href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <link href="https://3liz.github.io/remarkable.css" rel="stylesheet"/>
  <link href="logo.png" rel="icon" type="image/png" >
 </head>
 <body>
 <header class="header-container" style="">
    <h1>Étiquettes</h1>
 </header>
 <article>
 <p><a href="../">Up</a></p>
<p><a href="./index.html">Back</a></p><div class="toc"><span class="toctitle">Table of content</span><ul>
<li><a href="#la-gestion-des-etiquettes">La gestion des étiquettes</a><ul>
<li><a href="#rappel-des-fonctionnalites">Rappel des fonctionnalités</a></li>
<li><a href="#le-deplacement-manuel-des-etiquettes">Le déplacement manuel des étiquettes</a></li>
<li><a href="#utilisation-dune-expression-pour-construire-letiquette">Utilisation d'une expression pour construire l'étiquette</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="la-gestion-des-etiquettes">La gestion des étiquettes</h2>
<h3 id="rappel-des-fonctionnalites">Rappel des fonctionnalités</h3>
<p>Documentation : <a href="https://docs.qgis.org/3.10/fr/docs/user_manual/working_with_vector/vector_properties.html#labels-properties">https://docs.qgis.org/3.10/fr/docs/user_manual/working_with_vector/vector_properties.html#labels-properties</a></p>
<p>QGIS 3 présente une interface unifiée qui liste toutes les options accessibles <strong>dans une seule fenêtre</strong> dans l'onglet 
<code>Étiquettes</code> des propriétés de la couche vecteur :</p>
<ul>
<li>un <strong>aperçu</strong> du rendu de l’étiquette</li>
<li>
<p>une liste de <strong>sous-onglets</strong> pour configurer finement les options</p>
</li>
<li>
<p>Nous allons faire un étiquetage simple sur la couche <code>communes</code> :</p>
<ul>
<li>Se rendre dans l'onglet <code>Étiquettes</code> dans les propriétés de la couche vecteur : </li>
</ul>
</li>
<li>
<p>Choisir : </p>
<ul>
<li><code>Étiquettes simples</code></li>
<li><code>Étiquetter avec</code> le nom du champ que l'on souhaite afficher.</li>
</ul>
</li>
<li>
<p>Choisir une taille de police adaptée</p>
</li>
<li>Ajouter une petite zone tampon (un liséré blanc)</li>
<li>Définir des seuils de visibilités dans l'onglet <code>Rendu</code>.</li>
</ul>
<p>Le moteur d’étiquetage de QGIS est riche en fonctionnalités. L’interface regroupe les différentes options par
thèmes:</p>
<ul>
<li><strong>Texte</strong> : Police, Taille, casse, etc.</li>
<li><strong>Formatage</strong> : Retour à la ligne, alignement, formatage des nombres décimaux</li>
<li><strong>Tampon</strong> : taille, couleur, transparence</li>
<li><strong>Arrière-plan</strong> : Ajout de n’importe quel fond derrère l’étiquette (forme, SVG, etc.) + paramétrage fin</li>
<li><strong>Ombre</strong> : Définition d’un ombrage (position, décalage, transparence, etc.)</li>
<li><strong>Connecteurs</strong> : permet de générer une flèche entre le point géographique et l'étiquette quand ils sont éloignés</li>
<li><strong>Position</strong> : en fonction du type (polygone, lignes, points), Position et rotation via des colonnes, priorité</li>
<li><strong>Rendu</strong> : seuils d’échelle, paramètres avancés</li>
</ul>
<p><img alt="" src="media/12_parametres_etiquettes.png" title="Paramèters d'étiquettes"></p>
<p><strong>Certaines options sont spécifiques pour une géométrie.</strong></p>
<p>Chaque paramètre de la configuration peut soit:</p>
<ul>
<li>être choisi de manière classique parmi les <strong>choix proposés</strong></li>
<li>être dynamique via le <strong>choix d’un attribut ou d’une expression</strong></li>
</ul>
<p>Quand un icône est jaune, cela veut dire que le <strong>contôle par les données</strong> est actif. Le paramètre dans l'interface
graphique peut ne pas être pris en compte car il est <strong>peut-être</strong> surchargé au niveau de l'entité. Il est possible de
désactiver en faisant un clic-droit sur une propriété en jaune.</p>
<p><img alt="" src="media/data_defined_labels.png"></p>
<h3 id="le-deplacement-manuel-des-etiquettes">Le déplacement manuel des étiquettes</h3>
<p>QGIS 3 permet maintenant de <strong>déplacer les étiquettes manuellement</strong> sans avoir besoin de créer de couches spécifiques, ou d'utiliser le plugin <strong>Easy Custom Labelling</strong></p>
<p><strong>Notes</strong> </p>
<ul>
<li>Un déplacement manuel d'étiquette n'est <strong>valable que pour une échelle fixe</strong> !</li>
<li>Compacter d'abord les étiquettes: <code>wordwrap("NOM", 13, '-')</code></li>
<li>Il faut <strong>absolument</strong> une <strong>clé primaire de type entier</strong> comme <strong>identifiant unique</strong></li>
</ul>
<p><strong>Étapes</strong></p>
<ul>
<li>Pour gérer le déplacement, il faut utiliser la <strong>barre d'outils Étiquettes</strong></li>
<li>Choisir l'<strong>échelle</strong></li>
<li>Cocher <strong>Mettre en surbrillance les Étiquettes et les Diagrammes épinglés</strong></li>
<li>Cocher l'outil <strong>Déplacer les Etiquettes et les Diagrammes</strong></li>
<li>Au 1er clic sur la carte, une fenêtre demande de choisir l'<strong>identifiant unique de la couche</strong></li>
</ul>
<p><img alt="" src="media/13_barre_etiquette_et_stockage_auxiliaire.png" title="Etiquettes: barre et identifiant unique"></p>
<p>Vous pouvez ensuite utiliser cet outil <strong>Déplacer les étiquettes et les diagrammes</strong> en cliquant sur l'étiquette et en la faisant <strong>glisser à l'endroit désiré</strong>. Les étiquettes déplacées apparaissent <strong>avec un fond bleu</strong></p>
<p>D'autres outils permettent de <strong>tracer un rectangle autour des entités choisies</strong> et</p>
<ul>
<li><strong>épingler/désépingler</strong> les étiquettes: on les réinitialise,</li>
<li><strong>masquer/afficher</strong> les étiquettes: icône <strong>oeil</strong></li>
</ul>
<p>On peut aussi manuellement <strong>pivoter</strong> chaque étiquette, ou <strong>modifier toutes les propriétés</strong> d'une étiquette.</p>
<p>Les données sont enregistrées <strong>dans l'archive du projet QGZ</strong>, pour chaque couche. On peut voir les paramètres dans les propriétés de la couche, onglet <strong>Stockage auxiliaire</strong>.</p>
<p><img alt="" src="media/13_barre_etiquette_et_stockage_auxiliaire.png" title="Stockage auxiliaire"></p>
<h3 id="utilisation-dune-expression-pour-construire-letiquette">Utilisation d'une expression pour construire l'étiquette</h3>
<p>Par défaut, nous avons utilisé un champ de notre attributaire pour construire notre étiquette.</p>
<p>Nous souhaiterions désormais vouloir étiquetter en utilisant deux champs : le nom de la commune ET son code INSEE.
Il faut désormais utiliser le petit epsilon violet, qui comme vu dans la <a href="./01_interface.html">présentation de l'interface</a>
fait référence à la notion des <strong>expressions</strong>.</p>
<ul>
<li>
<p>Pour afficher le nom de la commune avec le code INSEE</p>
<ul>
<li>Attention aux différents opérateurs <code>+</code>, <code>||</code> et <code>concat()</code> qui permettent tous de concaténer des chaînes, mais
attention aux valeurs NULL et aux valeurs mathématiques. On recommande <code>concat</code> bien qu'elle soit un peu plus complexe.</li>
<li>Solution <code>concat("NOM", '\n', "CODE_INSEE")</code></li>
</ul>
</li>
<li>
<p>afficher une information calculée à la volée, comme la superficie de la commune en km² : </p>
<ul>
<li>La superficie en anglais se dit <code>area</code>.</li>
<li>La projection de la couche est actuellement en m, donc la surface est en m².</li>
<li>Solution partielle <code>$area / 1000000</code></li>
<li>Solution finale <code>concat("NOM", '\n', round($area / 1000000, 2), ' km²')</code></li>
</ul>
</li>
<li>
<p>changer pour afficher la densité de population</p>
<ul>
<li>Solution <code>concat("NOM", '\n', round("POPULATION" / ($area / 1000000, 2)), ' hab/km²')</code></li>
</ul>
</li>
</ul>
  </article>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>
