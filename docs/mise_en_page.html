
<!DOCTYPE HTML>
<html>
 <head>
  <meta charset="utf-8"/>
  <title>Mise en page</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css" rel="stylesheet"/>
  <link href="https://3liz.github.io/remarkable.css" rel="stylesheet"/>
  <link href="logo.png" rel="icon" type="image/png" >
 </head>
 <body>
 <header class="header-container" style="">
    <h1>Mise en page</h1>
 </header>
 <article>
 <p><a href="../">Up</a></p>
<p><a href="./index.html">Back</a></p><div class="toc"><span class="toctitle">Table of content</span><ul>
<li><a href="#mise-en-page-dune-carte">Mise en page d'une carte</a><ul>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#rappel-sur-les-elements-dune-carte">Rappel sur les éléments d'une carte</a></li>
<li><a href="#utilisation-de-loutil">Utilisation de l'outil</a><ul>
<li><a href="#encore-plus-loin-avec-les-expressions">Encore plus loin avec les expressions</a></li>
</ul>
</li>
<li><a href="#generer-un-atlas">Générer un atlas</a><ul>
<li><a href="#generer-un-rapport">Générer un rapport</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="mise-en-page-dune-carte">Mise en page d'une carte</h1>
<p>Anciennement <strong>composeur d'impression</strong> dans QGIS 2</p>
<h2 id="documentation">Documentation</h2>
<ul>
<li><a href="https://docs.qgis.org/3.10/fr/docs/user_manual/print_composer/index.html">https://docs.qgis.org/3.10/fr/docs/user_manual/print_composer/index.html</a></li>
</ul>
<h2 id="rappel-sur-les-elements-dune-carte">Rappel sur les éléments d'une carte</h2>
<ul>
<li>Menu <code>Projet</code> ▶ <code>Mise en page</code></li>
<li>Pour chaque projet QGIS, on peut créer une ou plusieurs <strong>mise en page</strong>.</li>
<li>Un <strong>gestionnaire de mise en page</strong> permet d’ajouter, modifier, renommer, supprimer une mise en page.</li>
<li>Chaque mise en page permet de créer sa carte à imprimer, en y insérant autant d’éléments que nécessaire.</li>
<li>Une mise en page doit au moins contenir:<ul>
<li><strong>carte</strong></li>
<li><strong>légende</strong></li>
<li><strong>barre d’échelle</strong></li>
<li><strong>flèche Nord</strong></li>
<li>bloc <strong>texte</strong> : titre, sources, commentaire, etc.</li>
</ul>
</li>
<li>D'autres éléments sont possibles:<ul>
<li>bloc <strong>HTML</strong> : une page web (ou distante)</li>
<li><strong>image</strong> : logos (png, SVG)</li>
<li><strong>table attributaire</strong></li>
<li>grille <strong>régulière</strong> sur une carte (graticule)</li>
<li>carte de localisation (à une échelle plus petite), ou alors un cartouche, pour le centre-ville</li>
<li>...</li>
</ul>
</li>
</ul>
<h2 id="utilisation-de-loutil">Utilisation de l'outil</h2>
<p><img alt="" src="media/interface_mise_en_page.png" title="Composeur d'impression, mise en page"></p>
<p>Depuis QGIS 3, on peut modifier les propriétés de chaque page indépendemment: taille et rotation par exemple: faire
 <strong>clic-droit</strong> sur la page et <strong>Propriétés de la page</strong>.</p>
<p>En utilisant les boutons "plus" dans la barre d'outils à gauche, ajouter les éléments à votre page. 
Dans le panneau <code>Propriétés de l'objet</code>, configurer les éléments en ouvrant les menus "tiroirs".</p>
<p>Chaque élément possède des propriétés qui lui sont propres.</p>
<p>Début de mise en page :</p>
<p><img alt="" src="media/26_composeur_mise_en_page.png" title="Composeur d'impression, mise en page"></p>
<ul>
<li>
<p><strong>Question</strong>, que manque-t-il sur cette mise en page?</p>
</li>
<li>
<p>QGIS permet de créer des composeurs avec <strong>plusieurs pages</strong>. Par exemple, une 1ère page pour la carte et la légende, 
et une seconde page pour la table attributaire et des images.</p>
</li>
</ul>
<h3 id="encore-plus-loin-avec-les-expressions">Encore plus loin avec les expressions</h3>
<p>Utiliser des expressions avec du texte dans les impressions : 
<a href="https://docs.qgis.org/3.10/en/docs/user_manual/print_composer/composer_items/composer_label.html#exploring-expressions-in-a-label-item">https://docs.qgis.org/3.10/en/docs/user_manual/print_composer/composer_items/composer_label.html#exploring-expressions-in-a-label-item</a></p>
<h2 id="generer-un-atlas">Générer un atlas</h2>
<p>Pour le moment, nous n'avons fait qu'une carte statique. Imaginons désormais que nous souhaiterions faire une collection 
de PDF, une par commune de notre département.</p>
<p>Pour générer un <strong>atlas</strong>, il faut: </p>
<ul>
<li>l'activer, via le menu <strong>Atlas / Paramètres de l'atlas</strong> en cochant la case <strong>Générer un atlas</strong></li>
<li>de choisir la <strong>couche de couverture</strong>, par exemple les communes</li>
<li>de choisir le champ ou l'expression qui donne le <strong>nom de l'objet</strong>, par exemple <code>concat("NOM", ' - ', "CODE_INSEE")</code></li>
<li>de choisir un <strong>filtre</strong> (optionnel): <code>"NOM LIKE 'A%'"</code></li>
<li>d'ordonner par un champ: <code>"NOM"</code></li>
<li>d'aller dans les <strong>propriétés de la carte</strong>, et de cocher <strong>Contrôlé par l'atlas</strong> et choisir la marge ou l'échelle 
pour zoomer sur chaque objet: 
<strong>Échelle prédéfinie</strong></li>
<li>d'activer l'aperçu pour tester: menu <strong>Atlas / Aperçu de l'atlas</strong> puis utiliser la <strong>barre d'outil Atlas</strong> pour 
passer d'une commune à l'autre</li>
</ul>
<p><img alt="" src="media/27_composeur_atlas.png" title="Composeur: atlas"></p>
<p>Documentation : <a href="https://docs.qgis.org/3.10/fr/docs/user_manual/print_composer/create_output.html#generate-an-atlas">https://docs.qgis.org/3.10/fr/docs/user_manual/print_composer/create_output.html#generate-an-atlas</a></p>
<p><strong>NB:</strong> </p>
<ul>
<li>On peut utiliser des <strong>expressions QGIS</strong> dans les <strong>Étiquettes</strong>, dans les filtres, dans les propriétés configurables 
via des expressions.</li>
<li>Par exemple, on souhaite factoriser le nom de l'organisation:<ul>
<li>Faire une variable au <a href="./01_interface.html">niveau global de QGIS</a> dans l'onglet <code>Variables</code></li>
<li>Modifier une étiquette pour utiliser cette <code>variable</code> dans la fenêtre des expressions pour l'utiliser.</li>
</ul>
</li>
<li>On peut contrôler le style de l'objet courant (la commune) via une expression dans la symbologie d'une couche à l'aide des icônes à droite : </li>
</ul>
<p><img alt="" src="media/data_defined_atlas.png" title="Data defined"></p>
<p>Pour la couleur de bordure :</p>
<pre><code class="sql">CASE 
WHEN @atlas_featureid = $id THEN 'red'
ELSE 'black'
END
</code></pre>

<p>Pour la largeur de bordure :</p>
<pre><code class="sql">CASE 
WHEN @atlas_featureid = $id THEN 1
ELSE 0.2
END
</code></pre>

<p><em>Note</em>, ces icônes deviennent jaune lorsqu'il y a une expression.</p>
<h3 id="generer-un-rapport">Générer un rapport</h3>
<p>Documentation : <a href="https://docs.qgis.org/3.10/fr/docs/user_manual/print_composer/create_reports.html">https://docs.qgis.org/3.10/fr/docs/user_manual/print_composer/create_reports.html</a></p>
<p>QGIS 3 ajoute un nouvel outil pour gérer finement un document à imprimer, via un objet qui s'appelle <strong>Rapport</strong>, qui permet :</p>
<ul>
<li>de définir une <strong>page d'entête et un pied de page</strong></li>
<li>d'insérer des pages dynamiquement dans des <strong>groupes et des sous-groupes de pages</strong></li>
</ul>
<p>L'idée est de pouvoir tout contrôler via QGIS, et d'éviter d'exporter une mise en page en PDF et de le reprendre avec un outil d'édition tiers. 
Pour cela, on utilise le menu <strong>Projet / Nouveau rapport</strong>.</p>
<p>L'interface du rapport est la même qu'une mise en page (cf ci-dessus), sauf qu'il y a un panneau supplémentaire, l'<code>Éditeur de rapport</code> sur la gauche
et que la barre d'outils <code>Atlas</code> n'existe plus.</p>
<p>L'arbre dans ce nouveau panneau permet de contrôler les paramètres du rapport :</p>
<ul>
<li><strong>Rapport</strong> permet de créer/modifier l'<strong>entête</strong> et le <strong>pied de page</strong> de tout le document.</li>
<li>Le <strong>bouton + vert</strong> permet d'ajouter des <strong>pages statiques</strong> ou une <strong>section de groupes de champs</strong></li>
<li>Chaque section de groupes de champs permet d'<strong>itérer sur les objets d'une couche</strong>, comme pour un atlas. Elle est caractérisée par <strong>une couche et un nom de champ</strong>, et peut avoir<ul>
<li>une <strong>entête</strong></li>
<li>un <strong>corps de document</strong></li>
<li>un <strong>pied de page</strong></li>
</ul>
</li>
<li>On peut ajouter un <strong>sous-groupe de champs</strong>, si la couche fille contient un champ qui est aussi <strong>présent dans la couche parente</strong> et permet de faire le lien, <code>CODE_INSEE</code>par exemple. Cela devient donc un atlas dans un atlas.
Concrétement en guise d'exemple, à l'échelle d'une région, nous pouvons itérer sur les départements, puis dans chaque département sur les communes.</li>
</ul>
<p><strong>Inconvénient</strong>: on ne peut pas filtrer sur les couches des sections de groupes de champs.</p>
<p><strong>Astuce</strong> : on peut importer un modèle de mise en page dans un rapport.</p>
<p><img alt="" src="media/28_composeur_rapport.png" title="Composeur, rapports"></p>
  </article>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js">
  </script>
  <script>
   hljs.initHighlightingOnLoad();
  </script>
  <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript">
  </script>
  <script type="text/javascript">
   MathJax.Hub.Config({"showProcessingMessages" : false,"messageStyle" : "none","tex2jax": { inlineMath: [ [ "$", "$" ] ] }});
  </script>
 </body>
</html>
